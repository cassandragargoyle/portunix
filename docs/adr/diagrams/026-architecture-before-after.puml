@startuml ADR-026 Architecture Before and After
!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0
skinparam componentStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor<<duplicate>> #FFE5E5
    BorderColor<<duplicate>> #FF0000
    BackgroundColor<<shared>> #E5FFE5
    BorderColor<<shared>> #00AA00
}

title ADR-026: Shared Platform Utilities\nArchitecture Before and After

package "Before - Code Duplication" {
    component "Main Binary\n(portunix)" as main1 #LightBlue {
        component "install/config.go" as config1 <<duplicate>> {
            [GetArchitecture()]
            [GetOS()]
        }
    }

    component "Helper Binary\n(ptx-installer)" as helper1 #LightCoral {
        component "engine/platform.go" as platform1 <<duplicate>> {
            [GetArchitecture()]
            [GetOS()]
        }
    }

    note right of config1
        **Problem:**
        Identical code in two places
        ~100 lines duplicated
        Risk of divergence
    end note
}

package "After - Shared Package" {
    component "Shared Package\nsrc/pkg/platform" as shared <<shared>> {
        component "platform.go" as platAPI {
            [GetOS()]
            [GetArchitecture()]
            [GetPlatform()]
            [IsWindows/Linux/Darwin()]
        }
        component "permissions.go" as permAPI {
            [IsRunningAsRoot()]
            [IsSudoAvailable()]
            [GetSudoPrefix()]
            [CanWriteToDirectory()]
        }
        component "platform_test.go" as tests {
            [12 Unit Tests]
        }
    }

    component "Main Binary\n(portunix)" as main2 #LightBlue {
        component "install/config.go" as config2 {
            note right: Can be refactored\nto use shared package
        }
    }

    component "Helper Binary\n(ptx-installer)" as helper2 #LightGreen {
        component "engine/platform.go" as platform2 {
            [Wrapper Functions]
        }
    }

    main2 ..> shared : <<imports>>
    helper2 ..> shared : <<imports>>
    platform2 ..> platAPI : uses
    platform2 ..> permAPI : uses

    note right of shared
        **Benefits:**
        ✓ Single source of truth
        ✓ Comprehensive tests
        ✓ Consistent behavior
        ✓ Easy maintenance
    end note
}

legend right
    |<#FFE5E5> Duplicated Code |
    |<#E5FFE5> Shared Package |
    |<#LightBlue> Main Binary |
    |<#LightCoral> Helper (Before) |
    |<#LightGreen> Helper (After) |
endlegend

@enduml
